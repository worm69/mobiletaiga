language: android
sudo: required
jdk: oraclejdk8
before_cache:
- rm -f $HOME/.gradle/caches/modules-2/modules-2.lock
- rm -fr $HOME/.gradle/caches/*/plugin-resolution/
cache:
  directories:
  - "$HOME/.gradle/caches/"
  - "$HOME/.gradle/wrapper/"
  - "$HOME/.android/build-cache"
env:
  global:
  - ANDROID_API=28
  - EMULATOR_API=28
  - ANDROID_BUILD_TOOLS=27.0.3
  - ADB_INSTALL_TIMEOUT=8
  - GRADLE_OPTS="-Xmx2048m"
  - secure: N9MNPrV8uyei/3ItU4WMGfSeUp9XyP9g2SjS12EC6mPE4I3ywO0R709dYTrGNliiT5EGLtxyFZ3SCYGUSxq/Q2AIHOdzIouMCxoliY77ZiChCyRDAL9obR0dh23/ItAVaJKsc8FR5DbGaSmmEWj+oeZVIVJULdTLOrg0trc886S4tH0J7AbYvTDuPRuehMNqZuUqct7Vy0znqXtFtV6KgUC6kMGPXiMRVqJjr+UuPZ7Hu9+i3KtGsuludFUHxbyToWaCdCT9WoVNXKX6hcLsbffIMNV6Fn/hCl1WW4BDLF9JwojHEPbg5GD90iQhpwoC64NgJkPoJouaqPzWSVJLz6J07ohvn0j/gwMj8PlYWgev82M7pOCV5GnLugNFmqnvMFP6Hmb9IDa9H7isqwpnmscHQrGJCD4imZpjZFtSEFL3bHaz7Bv71c38uf+s0x0V8x4/wzOhqtBtnEV0e9Ve8P9kYGrBL0+W5G0H2fJ00iZBN1i4A4jVeX86z3bV+X6FlDpyWtHzOYavb829PbQRa2XaDS6PywCII2/Prin9T5bcJSN4l7TRlGV8lB3Dh7TrVeMugjcj/6/1oGoz0gidWSwwITp3RtkW4ewCaZ1s19FNqDuVm/LXyDXo5iRBM93aZflPXmJSu2hMOGHzDv0e0ZsWcBI4qfkpDn4AN4NEguU=
  - secure: N/E+u+ICcH0xIfKgrHqpbIgWBVrlUsEf8Oc50mnnse65aVv/+7Ejg/b0/uNLdN8xaivRnnaB70f0XowXhvOfa+wmhTt8jQXbs0L5LrzuUPhih0O199qQZfI5VekEGFGQCh4lldQnJchhQMG97iIAcd2PWr+X5cCxLeeRPI38gtQTkPt5fEwrWsvYpBfjvYG54bypOR+5YBYNJ6nI9e6aOhodkFxZKOCpvfhRNznddKDh5aKrMyXWosviKqtXhWHpgEn6K7TI1gAsMYlKfJqdY1k5ikeXKlNvIpP89ADRVO9v4gbYZkQbXJksgnq+CbpI4j9+QNZcUxL/vHXkxI3LUtg2f2jQgMcT63TqAON18GZFJQyOWcAUv8sX6Hz0lX9RaRiVHqaopIzKqvliPgoFIV8qMrNLWzB5lXw0RZvlyBK8hBZBaFVuh2Sd4x4wgsNkc9So6WDqsU1+5zw4vZBNTvQDzwNwDxNrjOpQCA2Hjj4ZyvpIIQxd1HiKldw/SBR6SVwDc3R2I1jR2jUO02Z5ni5mSg2p/g5BSA5T7l+6p7gj8HLODkUH0PCgcuJtEeOevD37Q2RrKrqLGi0kiJVyHzsmHjZAFl1iGTkYNhX9AyR4AsaFGsFehhf8Y4ybJeqgEvT3V5GPxA5J+vYD1s5xwq55Cfv99Bz3dh838ixPUVg=
android:
  components:
  - tools
  - platform-tools
  - build-tools-$ANDROID_BUILD_TOOLS
  - android-$ANDROID_API
  - android-$EMULATOR_API_LEVEL
  - extra-google-m2repository
  - extra-android-m2repository
  - addon-google_apis-google-19
  - sys-img-armeabi-v7a-addon-google_apis-google-$ANDROID_API_LEVEL
  - sys-img-armeabi-v7a-addon-google_apis-google-$EMULATOR_API_LEVEL
  licenses:
  - android-sdk-preview-license-.+
  - android-sdk-license-.+
  - google-gdk-license-.+
before_script:
- echo no | android create avd --force -n test -t android-21 --abi armeabi-v7a
- emulator -avd test -no-skin -no-audio -no-window &
- android-wait-for-emulator
- adb shell input keyevent 82 &
script:
- "./gradlew clean build connectedCheck -PdisablePreDex --stacktrace"
before_deploy:
- cp $TRAVIS_BUILD_DIR/.keystore $HOME
- cd app/build/outputs/apk/
- jarsigner -verbose -sigalg SHA1withRSA -digestalg SHA1 -keystore $HOME/mobileTaiga.jks
  -storepass $storepass -keypass $keypass app-release-unsigned.apk mobileTaiga
- jarsigner -verify app-release-unsigned.apk
- "${ANDROID_HOME}/build-tools/24.0.2/zipalign -v 4 app-release-unsigned.apk yourapp.apk"
deploy:
  provider: releases
  file: yourapp.apk
  skip_cleanup: true
  on:
    repo: worm69/mobiletaiga
    tags: true
    jdk: oraclejdk8
  api_key:
    secure: BY2JoLCmSTKsZL48FRAWU6Wlp2HsTQKhXyOnMc8fV96BIFNNxsr63JxeC882G063LmDLgN4BGiN9IgV21/S2LQ+MVRtEJIztvG5BjSIdo1v7BUqlQ0pDv25t9gsQpfWQOznPLK/lwHCldLk3WtAZ++rnkTpWZxxRB8Kds/oP2FHCWUdkYeMUkCiA/MaQ0ROkfa2qxeRPB7A6c8+NcWJz8m/8RoeBEMoFuHVhUOSMCpDxR8ab0ZdzRxWZIloh6RnSS+nzHK9VfeVhApMNE1DQNL/X3B2BmIFEmjVGBXg7gTr06WUa/wOpM0FtZCQyYW9idYJEWjilmGwi7RePb4QQm1GFOmRgkYsuudX/g003qrKoh8ajChPz3zYNzbXMalF4jj8stfnA+cQvTzZxdebxnmzEDOYpXHOPyEPbney2R0wEnoXu5fO/Ab+ZN7fm9f0V8dxqDm2Dze0TU69Q5x9qa8xck4ZN4uOuND1wak6t8CSuultuxGumTwi562cSKwpncaTNRhksl/tpGQ4Oth0IifHYPMk3AG2y7MNGCAkz0c2l2kkeNJJw1AZYwkL4wLHC6cpXTwWsbrwkRoK7DAXWWBZNoMhcAIQ6rX54ZzJwhZfWHSCrLhWsJaYxLFroQWBePtamK3WvHq6BN3XjQZWGEty16k7XIPanN8IJmRknFHk=
notifications:
  email: false
after_failure: cat $TRAVIS_BUILD_DIR/app/build/outputs/lint-results-debug.xml
before_install:
- openssl aes-256-cbc -K $encrypted_9295c27c00b0_key -iv $encrypted_9295c27c00b0_iv
  -in mobileTaiga.jks.enc -out mobileTaiga.jks -d
